version: '2'

# Decode TMP stack
# Nginx used only for serving static files
# Bjoern WSGI server to server python flask

services:
  
  decode_static:
    restart: always
    container_name: decode_static
    image: nginx
    ports:
      - "5000:80"
    volumes:
     - ./nginx.conf:/etc/nginx/conf.d/nginx.conf:ro 
     - ./logs:/var/log/nginx
     #- ./html_test:/html
     - ./decode_pwa/dist:/html
     - ./proxy-admin-test:/html/proxy-admin
    
  #decode_api:
  #  restart: always
  #  container_name: decode_api
  #  build: ./dockerfiles/bjoern_flask_docker
  #  ports:
  #     - "5005:9808"
  #  volumes:
  #     - ./decode_server/server:/app

  decode_server:
    restart: always
    container_name: decode_server
    volumes:
      - ./decode_server/server:/app
    build: ./dockerfiles/flask-python3.7
    ports:
      - "5005:80"
    environment:
      - FLASK_APP=api.py
      - FLASK_DEBUG=1
      - 'RUN=flask run --host=0.0.0.0 --port=80'
    command: flask run --host=0.0.0.0 --port=80
    # Infinite loop, to keep it alive, for debugging
    # command: bash -c "while true; do echo 'sleeping...' && sleep 10; done"

